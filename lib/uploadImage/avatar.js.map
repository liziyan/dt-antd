{"version":3,"sources":["../../src/uploadImage/avatar.js"],"names":["TableDrawer","state","previewVisible","previewImage","fileList","loading","picName","handleCancel","setState","handlePreview","file","url","thumbUrl","handleRemove","fileLists","props","handleUploadImg","isLt2M","size","message","error","nextProps","imageUrl","list","uid","name","status","nextState","uploadButton","res","success","data","info","length","React","Component"],"mappings":"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","file":"avatar.js","sourcesContent":["import React from 'react';\r\nimport { \r\n  message,\r\n  Icon,\r\n  Upload,\r\n  Button,\r\n  Avatar,\r\n} from 'antd';\r\nimport { is, fromJS } from 'immutable';\r\nimport './style.less';\r\n\r\nexport default class TableDrawer extends React.Component {  \r\n  state = {\r\n    previewVisible: false, // 是否显示大图\r\n    previewImage: '', // 大图的地址\r\n    fileList: [], // 显示的缩略图地址\r\n    loading: false,\r\n    picName: 'xxx.png',\r\n  };\r\n  /**\r\n   * [beforeUpload 判断上传图片]\r\n   * @param  {[type]} file [description]\r\n   * @return {[type]}      [description]\r\n   */\r\n  beforeUpload(file) {    \r\n    const isLt2M = file.size / 1024 / 1024 < 2;\r\n    if (!isLt2M) {\r\n      message.error('图片太大超过2MB啦!');\r\n    }\r\n    return isLt2M;\r\n  }\r\n  /**\r\n   * [关闭缩略图]\r\n   * @return {[type]} [description]\r\n   */\r\n  handleCancel = () => this.setState({previewVisible: false})\r\n  /**\r\n   * [查看大图]\r\n   * @param  {[type]} file [description]\r\n   */\r\n  handlePreview = (file) => {\r\n    this.setState({\r\n      previewImage: file.url || file.thumbUrl,\r\n      previewVisible: true,\r\n    });\r\n  }\r\n  /**\r\n   * [删除照片]\r\n   */\r\n  handleRemove= () => {\r\n    let fileLists=[];\r\n    this.setState({\r\n      fileList: fileLists,\r\n    });\r\n    this.props.handleUploadImg();\r\n  }\r\n  /**\r\n   * [componentWillReceiveProps 子组件更新子组件]\r\n   * @param  {[type]} nextProps [description]\r\n   * @return {[type]}           [description]\r\n   */\r\n  componentWillReceiveProps(nextProps){\r\n    if(!is(fromJS(this.props), fromJS(nextProps)) && nextProps.imageUrl && !this.state.imageUrl){ \r\n      let list=[{\r\n        uid: -1,\r\n        name: 'xxx.png',\r\n        status: 'done',\r\n        url: nextProps.imageUrl,\r\n      }];\r\n      this.setState({\r\n        fileList: list,\r\n      });  \r\n    }\r\n  } \r\n  /**\r\n   * [shouldComponentUpdate 如果state值没有改变时就算调用了setState方法，页面也不会重新渲染]\r\n   * @param  {[type]} nextProps [description]\r\n   * @param  {[type]} nextState [description]\r\n   * @return {[type]}           [description]\r\n   */\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return !is(fromJS(this.props), fromJS(nextProps)) || !is(fromJS(this.state),fromJS(nextState))\r\n  } \r\n  /**\r\n   * [render description]\r\n   * @return {[type]} [description]\r\n   */\r\n  render() {\r\n    const {previewVisible, previewImage, fileList, loading} = this.state;\r\n    const {url}=this.props;\r\n    const uploadButton = (\r\n        loading ? <Icon type=\"loading\" /> : <Icon type=\"camera\" />\r\n    );\r\n    return (\r\n      <div className=\"clearfix avatar\">\r\n        <Upload\r\n          action={url}\r\n          listType='picture-card'\r\n          accept='image/png,image/jpg,image/jpeg,image/bmp'\r\n          fileList={fileList}\r\n          withCredentials={true}\r\n          onSuccess={(res)=>{\r\n            if (res.success) {\r\n              let list=[{\r\n                uid: -1,\r\n                name: this.state.picName,\r\n                status: 'done',\r\n                url: res.data,\r\n              }];\r\n              this.setState({\r\n                fileList: list,\r\n                loading: false,                \r\n              });\r\n              this.props.handleUploadImg(res.data);\r\n            } else {\r\n              message.error(res.message);\r\n            }\r\n          }}\r\n          onPreview={this.handlePreview}\r\n          onRemove={this.handleRemove}\r\n          onChange={(info)=>{\r\n            this.setState({               \r\n              loading: true,\r\n              picName: info.file.name,               \r\n            });\r\n          }}\r\n        >\r\n         {fileList.length >= 1 ? null : uploadButton}\r\n        </Upload>\r\n      </div>\r\n    );\r\n  }\r\n}"]}